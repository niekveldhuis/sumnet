
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>I. Extract Lemmatization from JSON &#8212; Sumerian Networks</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Sumerian Networks JupyterBook" href="welcome.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/sumnet.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Sumerian Networks</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="welcome.html">
   Sumerian Networks JupyterBook
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   I. Extract Lemmatization from JSON
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/PartI-ExtractLemmatizationfromJSON.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ybordag/sumnet-test/master?urlpath=tree/book/PartI-ExtractLemmatizationfromJSON.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/ybordag/sumnet-test/blob/master/book/PartI-ExtractLemmatizationfromJSON.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-oracc-data">
   1 Download ORACC Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-btdns-data">
   2 Download BTDNS Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extract-data-from-txt-file">
     2.1 Extract Data from .txt file.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#filtering-data">
     2.2 Filtering Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parsing-the-data">
   3 Parsing the Data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-parse-oracc-json-function">
     3.1 The
     <code class="docutils literal notranslate">
      <span class="pre">
       parse_ORACC_json()
      </span>
     </code>
     function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-catalogue-data-for-the-oracc-drehem-tablets">
     3.2 Getting Catalogue Data for the  ORACC Drehem Tablets.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#call-the-parse-oracc-json-function-for-every-json-file">
     3.3 Call the
     <code class="docutils literal notranslate">
      <span class="pre">
       parse_ORACC_json()
      </span>
     </code>
     function for every
     <code class="docutils literal notranslate">
      <span class="pre">
       JSON
      </span>
     </code>
     file
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-structuring">
   4 Data Structuring
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transform-the-data-into-a-dataframe">
     4.1 Transform the Data into a DataFrame
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#remove-spaces-and-commas-from-guide-word-and-sense">
     4.2 Remove Spaces and Commas from Guide Word and Sense
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-line-id">
     4.3 Create Line ID
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-lemma-column">
   5 Create Lemma Column
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#select-relevant-columns">
   6 Select Relevant Columns
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#save-results-in-csv-file-pickle">
   7 Save Results in CSV file &amp; Pickle
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="i-extract-lemmatization-from-json">
<h1>I. Extract Lemmatization from JSON<a class="headerlink" href="#i-extract-lemmatization-from-json" title="Permalink to this headline">¶</a></h1>
<p>The code in this section will parse the <a class="reference external" href="http://oracc.org">ORACC</a> JSON data of the Ur III corpus to extract lemmatization data.</p>
<p>The output contains text IDs, line IDs, lemmas, and relevant other data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#create necessary directories</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;jsonzip&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># import necessary libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="c1"># import libraries for this section</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">json</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="download-oracc-data">
<h2>1 Download ORACC Data<a class="headerlink" href="#download-oracc-data" title="Permalink to this headline">¶</a></h2>
<p>We will begin by downloading the lemmatization data from ORACC. This will be downloaded in the form of zipped JSON files which we will parse in the next subsection and store in a usable pandas dataframe.</p>
<p>The ORACC database can be accessed via <a class="reference external" href="http://oracc.org/">http://oracc.org/</a>. As we are interested in the UR III data, we will use the project name to make the request. The project name corresponds to the last part of the url: <a class="reference external" href="http://oracc.org/epsd2/admin/ur3">http://oracc.org/epsd2/admin/ur3</a> and thus the project name is ‘epsd2/admin/u3admin’. We are accessing the JSON through the API and so our request URL is <a class="reference external" href="http://build-oracc.museum.upenn.edu/json/epsd2-admin-ur3">http://build-oracc.museum.upenn.edu/json/epsd2-admin-ur3</a>.</p>
<p>If you are unfamiliar with using APIs and would like to learn how to do so in Python, this section of the Data 100 textbook might be helpful: <a class="reference external" href="http://www.textbook.ds100.org/ch/13/web_http.html">http://www.textbook.ds100.org/ch/13/web_http.html</a></p>
<p><strong>NOTE:</strong> If you already have this data, you can skip this step as it can take quite a long time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">project</span> <span class="o">=</span> <span class="s1">&#39;epsd2/admin/ur3&#39;</span> <span class="c1">#define project to download.</span>

<span class="n">CHUNK</span> <span class="o">=</span> <span class="mi">1024</span> <span class="c1">#define chunk size</span>

<span class="n">proj</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://build-oracc.museum.upenn.edu/json/</span><span class="si">%s</span><span class="s2">.zip&quot;</span> <span class="o">%</span> <span class="n">proj</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;jsonzip/</span><span class="si">%s</span><span class="s2">.zip&quot;</span> <span class="o">%</span> <span class="n">proj</span>
<span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">request</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
      <span class="c1">#if file is accessible, download</span>
      <span class="n">tqdm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Saving &#39;</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s1">&#39; as &#39;</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">)</span>
      <span class="n">total_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content-length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
      <span class="n">tqdm_handler</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">total_size</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">desc</span> <span class="o">=</span> <span class="n">project</span><span class="p">)</span>
      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>
        <span class="c1">#use tdqm to show download speed</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK</span><span class="p">):</span>
          <span class="n">tqdm_handler</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
          <span class="n">zip_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">tqdm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;WARNING: </span><span class="si">%s</span><span class="s2"> does not exist.&quot;</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Saving http://build-oracc.museum.upenn.edu/json/epsd2-admin-ur3.zip as jsonzip/epsd2-admin-ur3.zip
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "b36494795e994bd59b053619fbf22427", "version_major": 2, "version_minor": 0}
</script><div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mf">2e5</span><span class="n">c5013c838</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>       <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_file</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>         <span class="c1">#use tdqm to show download speed</span>
<span class="ne">---&gt; </span><span class="mi">16</span>         <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>           <span class="n">tqdm_handler</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>           <span class="n">zip_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

<span class="nn">c:\programdata\miniconda3\lib\site-packages\requests\models.py</span> in <span class="ni">generate</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">751</span>             <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="s1">&#39;stream&#39;</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">752</span>                 <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">753</span>                     <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">decode_content</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">754</span>                         <span class="k">yield</span> <span class="n">chunk</span>
<span class="g g-Whitespace">    </span><span class="mi">755</span>                 <span class="k">except</span> <span class="n">ProtocolError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">c:\programdata\miniconda3\lib\site-packages\urllib3\response.py</span> in <span class="ni">stream</span><span class="nt">(self, amt, decode_content)</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">575</span>             <span class="k">while</span> <span class="ow">not</span> <span class="n">is_fp_closed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">576</span>                 <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">amt</span><span class="o">=</span><span class="n">amt</span><span class="p">,</span> <span class="n">decode_content</span><span class="o">=</span><span class="n">decode_content</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">577</span> 
<span class="g g-Whitespace">    </span><span class="mi">578</span>                 <span class="k">if</span> <span class="n">data</span><span class="p">:</span>

<span class="nn">c:\programdata\miniconda3\lib\site-packages\urllib3\response.py</span> in <span class="ni">read</span><span class="nt">(self, amt, decode_content, cache_content)</span>
<span class="g g-Whitespace">    </span><span class="mi">517</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">518</span>                 <span class="n">cache_content</span> <span class="o">=</span> <span class="kc">False</span>
<span class="ne">--&gt; </span><span class="mi">519</span>                 <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">fp_closed</span> <span class="k">else</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">520</span>                 <span class="k">if</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">521</span>                     <span class="n">amt</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data</span>

<span class="nn">c:\programdata\miniconda3\lib\http\client.py</span> in <span class="ni">read</span><span class="nt">(self, amt)</span>
<span class="g g-Whitespace">    </span><span class="mi">455</span>             <span class="c1"># Amount is given, implement using readinto</span>
<span class="g g-Whitespace">    </span><span class="mi">456</span>             <span class="n">b</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">457</span>             <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">458</span>             <span class="k">return</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">b</span><span class="p">)[:</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">459</span>         <span class="k">else</span><span class="p">:</span>

<span class="nn">c:\programdata\miniconda3\lib\http\client.py</span> in <span class="ni">readinto</span><span class="nt">(self, b)</span>
<span class="g g-Whitespace">    </span><span class="mi">499</span>         <span class="c1"># connection, and the user is reading more bytes than will be provided</span>
<span class="g g-Whitespace">    </span><span class="mi">500</span>         <span class="c1"># (for example, reading in 1k chunks)</span>
<span class="ne">--&gt; </span><span class="mi">501</span>         <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">502</span>         <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">and</span> <span class="n">b</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">503</span>             <span class="c1"># Ideally, we would raise IncompleteRead if the content-length</span>

<span class="nn">c:\programdata\miniconda3\lib\socket.py</span> in <span class="ni">readinto</span><span class="nt">(self, b)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span>         <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">588</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">589</span>                 <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">recv_into</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">590</span>             <span class="k">except</span> <span class="n">timeout</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">591</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_timeout_occurred</span> <span class="o">=</span> <span class="kc">True</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="download-btdns-data">
<h2>2 Download BTDNS Data<a class="headerlink" href="#download-btdns-data" title="Permalink to this headline">¶</a></h2>
<p>Go to <a class="reference external" href="http://bdtns.filol.csic.es/index.php?p=formulario_urIII">http://bdtns.filol.csic.es/index.php?p=formulario_urIII</a>.</p>
<p>In the Provenience drop down menu choose “Puzriš-Dagan” and hit “Search”. This will give a list of about 15,000 tablets from Drehem.</p>
<p>Now, hit “Export” on the left and in the pop-up window select every box except “Transliteration of the whole text(s)”. Hit “export”. This will produce a .txt file and you’ll need to put it into the “bdtns_metadata” folder.</p>
<p>The name of the .txt file changes everytime we download, so you’ll need to change the following cell.</p>
<div class="section" id="extract-data-from-txt-file">
<h3>2.1 Extract Data from .txt file.<a class="headerlink" href="#extract-data-from-txt-file" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bdtns_catalogue_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/niekveldhuis/sumnet/master/QUERY_catalogue.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">bdtns_catalogue_data</span> <span class="o">=</span> <span class="n">bdtns_catalogue_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;CDLI_no&#39;</span><span class="p">)</span>
<span class="n">bdtns_catalogue_data</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="filtering-data">
<h3>2.2 Filtering Data<a class="headerlink" href="#filtering-data" title="Permalink to this headline">¶</a></h3>
<p>Filter data for Puzriš-Dagān tablets and drop tablets with null p-numbers or without dates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bdtns_catalogue_data</span> <span class="o">=</span> <span class="n">bdtns_catalogue_data</span><span class="p">[(</span><span class="n">bdtns_catalogue_data</span><span class="p">[</span><span class="s1">&#39;Provenience&#39;</span><span class="p">]</span>
    <span class="o">==</span><span class="s1">&#39;Puzriš-Dagān&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">bdtns_catalogue_data</span><span class="p">[</span><span class="s1">&#39;Provenience&#39;</span><span class="p">]</span>
    <span class="o">==</span><span class="s1">&#39;Puzriš-Dagān (?)&#39;</span><span class="p">)]</span> <span class="c1">#select for Puzriš-Dagān</span>

<span class="c1">#select for non-null p_numbers and non-null dates</span>
<span class="n">bdtns_catalogue_data</span> <span class="o">=</span> <span class="n">bdtns_catalogue_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">bdtns_catalogue_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> <span class="p">:]</span>
<span class="n">bdtns_catalogue_data</span> <span class="o">=</span> <span class="n">bdtns_catalogue_data</span><span class="p">[</span><span class="o">~</span><span class="n">bdtns_catalogue_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>

<span class="n">bdtns_catalogue_data</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="parsing-the-data">
<h2>3 Parsing the Data<a class="headerlink" href="#parsing-the-data" title="Permalink to this headline">¶</a></h2>
<p>In this subsection we will parse the imported <code class="docutils literal notranslate"><span class="pre">json</span></code> data into a list we can later use to construct a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> dataframe.</p>
<div class="section" id="the-parse-oracc-json-function">
<h3>3.1 The <code class="docutils literal notranslate"><span class="pre">parse_ORACC_json()</span></code> function<a class="headerlink" href="#the-parse-oracc-json-function" title="Permalink to this headline">¶</a></h3>
<p>Here we define the <code class="docutils literal notranslate"><span class="pre">parse_ORACC_json()</span></code> function, which will recursively parse the <code class="docutils literal notranslate"><span class="pre">json</span></code> files provided by ORACC until it finds the relevant lemma data. It takes in the an ORACC json data structure, the associated meta_data, and some necessary keys and returns a list of lemma python dictionary entries which we can use to constuct a pandas dataframe.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">json</span></code> files consist of a hierarchy of <code class="docutils literal notranslate"><span class="pre">cdl</span></code> nodes; only the nodes which have ‘f’ or ‘strict’ keys contain lemmatization data. The function goes down this hierarchy by recursively calling itself when a new <code class="docutils literal notranslate"><span class="pre">cdl</span></code> node is encountered. For more information about the data hierarchy in the <a class="reference external" href="http://oracc.org">ORACC</a> <code class="docutils literal notranslate"><span class="pre">json</span></code> files, see <a class="reference external" href="http://oracc.org/doc/opendata/index.html">ORACC Open Data</a>.</p>
<p>The argument of the <code class="docutils literal notranslate"><span class="pre">parse_ORACC_json()</span></code> function is a <code class="docutils literal notranslate"><span class="pre">JSON</span></code> object, essentially a Python dictionary that initially contains the entire contents of the original JSON file. The code works with a list of <code class="docutils literal notranslate"><span class="pre">JSON</span></code> dictionaries associated with the <code class="docutils literal notranslate"><span class="pre">cdl</span></code> key. Iterating through these dictionaries, if a dictionary contains another <code class="docutils literal notranslate"><span class="pre">cdl</span></code> node, the function calls itself with this lower-level dictionary as its argument <code class="docutils literal notranslate"><span class="pre">lemmatized_data_json</span></code>. Then the function will continue to recurse deeper into the data until it does not encounter any more <code class="docutils literal notranslate"><span class="pre">cdl</span></code> keys. Then, we are left with individual words. The code checks for a key <code class="docutils literal notranslate"><span class="pre">f</span></code>, and appendeds it’s data as a <code class="docutils literal notranslate"><span class="pre">lemma</span></code> to the list <code class="docutils literal notranslate"><span class="pre">lemma_list</span></code>. The list <code class="docutils literal notranslate"><span class="pre">lemm_list</span></code>, which is initiated at the start of the function, is extended with the new lemmas at the end of each recursion, where each <code class="docutils literal notranslate"><span class="pre">lemma</span></code> dictionary represents a single word.</p>
<p>The variable <code class="docutils literal notranslate"><span class="pre">id_text</span></code> consists of a project abbreviation, such as <code class="docutils literal notranslate"><span class="pre">blms</span></code> or <code class="docutils literal notranslate"><span class="pre">cams/gkab</span></code> plus a text ID, in the format <code class="docutils literal notranslate"><span class="pre">cams/gkab/P338616</span></code> or <code class="docutils literal notranslate"><span class="pre">dcclt/Q000039</span></code>.</p>
<p>The variable <code class="docutils literal notranslate"><span class="pre">ftype</span></code> is used to denote if a node is a year name (<code class="docutils literal notranslate"><span class="pre">yn</span></code>) or not.</p>
<p>The field <code class="docutils literal notranslate"><span class="pre">word_id</span></code> consists of three parts, namely a text ID, line ID, and word ID, in the format <code class="docutils literal notranslate"><span class="pre">Q000039.76.2</span></code> meaning: the second word in line 76 of text object <code class="docutils literal notranslate"><span class="pre">Q000039</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">76</span></code> is not a line number strictly speaking but an object reference within the text object. Things like horizontal rulings, columns, and breaks also get object references. The <code class="docutils literal notranslate"><span class="pre">word_id</span></code> field allows us to put lines, breaks, and horizontal drawings together in the proper order.</p>
<p>The field <code class="docutils literal notranslate"><span class="pre">label</span></code> is a human-legible label that refers to a line or another part of the text; it may look like <code class="docutils literal notranslate"><span class="pre">o</span> <span class="pre">i</span> <span class="pre">23</span></code> (obverse column 1 line 23) or <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">v</span> <span class="pre">23'</span></code> (reverse column 5 line 23 prime). The <code class="docutils literal notranslate"><span class="pre">label</span></code> field is used in online <a class="reference external" href="http://oracc.org">ORACC</a> editions to indicate line numbers. The <code class="docutils literal notranslate"><span class="pre">date</span></code>, <code class="docutils literal notranslate"><span class="pre">dates_references</span></code>, <code class="docutils literal notranslate"><span class="pre">primary_publication</span></code>, <code class="docutils literal notranslate"><span class="pre">collection</span></code>, and <code class="docutils literal notranslate"><span class="pre">museum_no</span></code> fields are also metadata which were taken from the ORACC catalogue.</p>
<p>The fields <code class="docutils literal notranslate"><span class="pre">extent</span></code>, <code class="docutils literal notranslate"><span class="pre">scope</span></code>, and <code class="docutils literal notranslate"><span class="pre">state</span></code> give metatextual data about the condition of the object; they capture the number of broken lines or columns and similar information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_ORACC_json</span><span class="p">(</span><span class="n">lemmatized_data_json</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">dollar_keys</span><span class="p">):</span>
    <span class="n">lemma_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">JSONobject</span> <span class="ow">in</span> <span class="n">lemmatized_data_json</span><span class="p">[</span><span class="s1">&#39;cdl&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;cdl&#39;</span> <span class="ow">in</span> <span class="n">JSONobject</span><span class="p">:</span> 
            <span class="n">lemma_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse_ORACC_json</span><span class="p">(</span><span class="n">JSONobject</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">dollar_keys</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">JSONobject</span><span class="p">:</span>
            <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;f&#39;</span> <span class="ow">in</span> <span class="n">JSONobject</span><span class="p">:</span>
            <span class="n">lemma</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;ftype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ftype&#39;</span><span class="p">)</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;id_word&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;dates_references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;dates_references&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;publication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;publication&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;museum_no&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;museum_no&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;metadata_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;metadata_source&#39;</span><span class="p">]</span>
            <span class="n">lemma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lemma</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;strict&#39;</span> <span class="ow">in</span> <span class="n">JSONobject</span> <span class="ow">and</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s1">&#39;strict&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">lemma</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">JSONobject</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dollar_keys</span><span class="p">}</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;id_word&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">JSONobject</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;dates_references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;dates_references&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;publication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;publication&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;museum_no&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;museum_no&#39;</span><span class="p">]</span>
            <span class="n">lemma</span><span class="p">[</span><span class="s1">&#39;metadata_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;metadata_source&#39;</span><span class="p">]</span>
            <span class="n">lemma_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lemma</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lemma_list</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="getting-catalogue-data-for-the-oracc-drehem-tablets">
<h3>3.2 Getting Catalogue Data for the  ORACC Drehem Tablets.<a class="headerlink" href="#getting-catalogue-data-for-the-oracc-drehem-tablets" title="Permalink to this headline">¶</a></h3>
<p>Before constructing our dataframe of lemmatized data, we will construct a dataframe of Drehem tablet metadata to filter and augment the data with.</p>
<p>We do this by loading the data from the <code class="docutils literal notranslate"><span class="pre">catalogue.json</span></code> into a dataframe and selecting the pnumbers where the provenience is indicated to be Puzriš-Dagan or modern Drehem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zip_file</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="s2">&quot;jsonzip/</span><span class="si">%s</span><span class="s2">.zip&quot;</span> <span class="o">%</span> <span class="n">proj</span><span class="p">)</span>    <span class="c1"># create a Zipfile object</span>

<span class="n">files</span> <span class="o">=</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
<span class="n">oracc_json_str</span> <span class="o">=</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/catalogue.json&quot;</span> <span class="o">%</span> <span class="n">project</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1">#read and decode the json file of one particular text</span>
<span class="n">oracc_catalogue_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">oracc_json_str</span><span class="p">)[</span><span class="s1">&#39;members&#39;</span><span class="p">]</span>

<span class="n">zip_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1">#create combined catalogue_data</span>
<span class="n">oracc_catalogue_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">oracc_catalogue_json</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">catalogue_data</span> <span class="o">=</span> <span class="n">oracc_catalogue_data</span><span class="p">[(</span><span class="n">oracc_catalogue_data</span><span class="p">[</span><span class="s1">&#39;provenience&#39;</span><span class="p">]</span> 
    <span class="o">==</span> <span class="s1">&#39;Puzriš-Dagan (mod. Drehem)&#39;</span><span class="p">)</span> <span class="o">|</span> 
    <span class="n">oracc_catalogue_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bdtns_catalogue_data</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
    <span class="c1">#choose catalogue entries marked as Puzriš-Dagan in either ORACC or BDTNS</span>

<span class="c1">#add bdtns dates to oracc dataset and name metadata source</span>
<span class="c1">#added line to suppress setting with copy warning</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">chained_assignment</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># default=&#39;warn&#39;</span>
<span class="n">in_bdtns_index</span> <span class="o">=</span> <span class="n">catalogue_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bdtns_catalogue_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">catalogue_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_bdtns_index</span><span class="p">,</span> <span class="s1">&#39;date_of_origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bdtns_catalogue_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<span class="n">catalogue_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_bdtns_index</span><span class="p">,</span> <span class="s1">&#39;dates_referenced&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bdtns_catalogue_data</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
<span class="n">catalogue_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">in_bdtns_index</span><span class="p">,</span> <span class="s1">&#39;provenience&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bdtns_catalogue_data</span><span class="p">[</span><span class="s1">&#39;Provenience&#39;</span><span class="p">]</span>
<span class="n">catalogue_data</span><span class="p">[</span><span class="s1">&#39;metadata_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;BDTNS&#39;</span> <span class="k">if</span> <span class="n">in_bdtns</span> <span class="k">else</span> <span class="s1">&#39;ORACC&#39;</span> <span class="k">for</span> <span class="n">in_bdtns</span> <span class="ow">in</span> <span class="n">in_bdtns_index</span><span class="p">]</span>


<span class="n">catalogue_data</span> <span class="o">=</span> <span class="n">catalogue_data</span><span class="p">[[</span><span class="s1">&#39;date_of_origin&#39;</span><span class="p">,</span> <span class="s1">&#39;dates_referenced&#39;</span><span class="p">,</span> <span class="s1">&#39;collection&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;primary_publication&#39;</span><span class="p">,</span> <span class="s1">&#39;museum_no&#39;</span><span class="p">,</span> <span class="s1">&#39;provenience&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;metadata_source&#39;</span><span class="p">]]</span>

<span class="n">catalogue_data</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="call-the-parse-oracc-json-function-for-every-json-file">
<h3>3.3 Call the <code class="docutils literal notranslate"><span class="pre">parse_ORACC_json()</span></code> function for every <code class="docutils literal notranslate"><span class="pre">JSON</span></code> file<a class="headerlink" href="#call-the-parse-oracc-json-function-for-every-json-file" title="Permalink to this headline">¶</a></h3>
<p>Here we will use the <code class="docutils literal notranslate"><span class="pre">parse_ORACC_json()</span></code> and the <code class="docutils literal notranslate"><span class="pre">catalogue</span></code> dataframe to construct the <code class="docutils literal notranslate"><span class="pre">words_df</span></code> dataframe which we will be using throughout the rest of the code. The project <code class="docutils literal notranslate"><span class="pre">zip</span></code> file downloaded earlier contains a directory that is called <code class="docutils literal notranslate"><span class="pre">corpusjson</span></code> that contains a JSON file for every text that is available in that corpus. The files are named using their text IDs in the pattern <code class="docutils literal notranslate"><span class="pre">P######.json</span></code> (or <code class="docutils literal notranslate"><span class="pre">Q######.json</span></code> or <code class="docutils literal notranslate"><span class="pre">X######.json</span></code>).</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">namelist()</span></code> of the <code class="docutils literal notranslate"><span class="pre">zipfile</span></code> package is used to create a list of the names of all the files in the ZIP. From this list we select all the file names in the <code class="docutils literal notranslate"><span class="pre">corpusjson</span></code> directory with extension <code class="docutils literal notranslate"><span class="pre">.json</span></code> (this way we exclude the name of the directory itself).</p>
<p>Each of these files is read from the <code class="docutils literal notranslate"><span class="pre">zip</span></code> file and loaded with the command <code class="docutils literal notranslate"><span class="pre">json.loads()</span></code>, which transforms the string into a proper JSON object.</p>
<p>This JSON object (essentially a Python dictionary), which is called <code class="docutils literal notranslate"><span class="pre">data_json</span></code> is now sent to the <code class="docutils literal notranslate"><span class="pre">parse_ORACC_json()</span></code> function. The function adds lemmata to the <code class="docutils literal notranslate"><span class="pre">lemm_l</span></code> list. In the end, <code class="docutils literal notranslate"><span class="pre">lemm_l</span></code> will contain as many list elements as there are words in all the texts in the projects requested.</p>
<p>The dictionary <code class="docutils literal notranslate"><span class="pre">meta_d</span></code> is created to hold temporary information. The value of the key <code class="docutils literal notranslate"><span class="pre">id_text</span></code> is updated in the main process every time a new JSON file is opened and send to the <code class="docutils literal notranslate"><span class="pre">parsejson()</span></code> function. The <code class="docutils literal notranslate"><span class="pre">parsejson()</span></code> function itself will change values or add new keys, depending on the information found while iterating through the JSON file. When a new lemma row is created, <code class="docutils literal notranslate"><span class="pre">parse_ORACC_json()</span></code> will supply data such as <code class="docutils literal notranslate"><span class="pre">id_text</span></code>, <code class="docutils literal notranslate"><span class="pre">label</span></code> and (potentially) other information from <code class="docutils literal notranslate"><span class="pre">meta_d</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lemma_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">meta_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="n">dollar_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;extent&#39;</span><span class="p">,</span> <span class="s1">&#39;scope&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">]</span>

<span class="k">try</span><span class="p">:</span>
  <span class="n">zip_file</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>       <span class="c1"># create a Zipfile object</span>
<span class="k">except</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;does not exist or is not a proper ZIP file&#39;</span><span class="p">)</span>

<span class="n">drehem_list_oracc</span> <span class="o">=</span> <span class="n">catalogue_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span> <span class="o">+</span> <span class="s1">&#39;/corpusjson/&#39;</span> <span class="o">+</span> <span class="n">p_number</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span> <span class="k">for</span> <span class="n">p_number</span> <span class="ow">in</span> <span class="n">drehem_list_oracc</span><span class="p">]</span>    <span class="c1">#that holds all the P, Q, and X numbers.</span>
<span class="k">for</span> <span class="n">lemma_file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">desc</span> <span class="o">=</span> <span class="n">project</span><span class="p">):</span>       <span class="c1">#iterate over the file names</span>
  <span class="n">id_text</span> <span class="o">=</span> <span class="n">project</span> <span class="o">+</span> <span class="n">lemma_file</span><span class="p">[</span><span class="o">-</span><span class="mi">13</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="c1"># id_text is, for instance, blms/P414332</span>

  <span class="n">p_number</span> <span class="o">=</span> <span class="n">lemma_file</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
  <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">id_text</span>
  <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalogue_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_number</span><span class="p">][</span><span class="s1">&#39;date_of_origin&#39;</span><span class="p">]</span>
  <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;dates_references&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalogue_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_number</span><span class="p">][</span><span class="s1">&#39;dates_referenced&#39;</span><span class="p">]</span>
  <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;publication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalogue_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_number</span><span class="p">][</span><span class="s1">&#39;primary_publication&#39;</span><span class="p">]</span>
  <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalogue_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_number</span><span class="p">][</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span>
  <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;museum_no&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalogue_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_number</span><span class="p">][</span><span class="s1">&#39;museum_no&#39;</span><span class="p">]</span>
  <span class="n">meta_data</span><span class="p">[</span><span class="s1">&#39;metadata_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">catalogue_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">p_number</span><span class="p">][</span><span class="s1">&#39;metadata_source&#39;</span><span class="p">]</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="n">json_str</span> <span class="o">=</span> <span class="n">zip_file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">lemma_file</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>         <span class="c1">#read and decode the json file of one particular text</span>
    <span class="n">lemmatized_data_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>                <span class="c1"># make it into a json object (essentially a dictionary)</span>
    <span class="n">lemma_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parse_ORACC_json</span><span class="p">(</span><span class="n">lemmatized_data_json</span><span class="p">,</span> <span class="n">meta_data</span><span class="p">,</span> <span class="n">dollar_keys</span><span class="p">))</span>               <span class="c1"># and send to the parse_ORACC_json() function</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">id_text</span><span class="p">,</span> <span class="s1">&#39;is not available or not complete&#39;</span><span class="p">)</span>

<span class="n">zip_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="data-structuring">
<h2>4 Data Structuring<a class="headerlink" href="#data-structuring" title="Permalink to this headline">¶</a></h2>
<p>Here we construct our <code class="docutils literal notranslate"><span class="pre">pandas</span></code> dataframe.</p>
<div class="section" id="transform-the-data-into-a-dataframe">
<h3>4.1 Transform the Data into a DataFrame<a class="headerlink" href="#transform-the-data-into-a-dataframe" title="Permalink to this headline">¶</a></h3>
<p>Here we use <code class="docutils literal notranslate"><span class="pre">lemma_list</span></code> to make our dataframe and we view it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">lemma_list</span><span class="p">)</span>
<span class="n">words_df</span> <span class="o">=</span> <span class="n">words_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>      <span class="c1"># fill empty values with empty strings</span>
<span class="n">words_df</span><span class="p">[</span><span class="n">words_df</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sux&#39;</span><span class="p">]</span> <span class="c1"># display lemmas where language is Sumerian</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_df</span><span class="o">.</span><span class="n">shape</span>   <span class="c1"># see shape</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_df</span><span class="o">.</span><span class="n">columns</span> <span class="c1"># see column names</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="remove-spaces-and-commas-from-guide-word-and-sense">
<h3>4.2 Remove Spaces and Commas from Guide Word and Sense<a class="headerlink" href="#remove-spaces-and-commas-from-guide-word-and-sense" title="Permalink to this headline">¶</a></h3>
<p>Spaces and commas in Guide Word and Sense may cause trouble in computational methods in tokenization, or when saved in Comma Separated Values format. All spaces and commas are replaced by hyphens and nothing (empty string), respectively.</p>
<p>By default the <code class="docutils literal notranslate"><span class="pre">replace()</span></code> function in <code class="docutils literal notranslate"><span class="pre">pandas</span></code> will match the entire string (that is, “lugal” matches “lugal” but there is no match between “l” and “lugal”). In order to match partial strings the parameter <code class="docutils literal notranslate"><span class="pre">regex</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">replace()</span></code> function takes a nested dictionary as argument. The top-level keys identify the columns on which the <code class="docutils literal notranslate"><span class="pre">replace()</span></code> function should operate (in this case ‘gw’ and ‘sense’). The value of each key is another dictionary with the search string as key and the replace string as value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">findreplace</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39; &#39;</span> <span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="n">words_df</span> <span class="o">=</span> <span class="n">words_df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;gw&#39;</span> <span class="p">:</span> <span class="n">findreplace</span><span class="p">,</span> <span class="s1">&#39;sense&#39;</span> <span class="p">:</span> <span class="n">findreplace</span><span class="p">},</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The columns in the resulting DataFrame correspond to the elements of a full <a class="reference external" href="http://oracc.org">ORACC</a> signature, plus information about text, line, and word ids:</p>
<ul class="simple">
<li><p>base (Sumerian only)</p></li>
<li><p>cf (Citation Form)</p></li>
<li><p>cont (continuation of the base; Sumerian only)</p></li>
<li><p>epos (Effective Part of Speech)</p></li>
<li><p>form (transliteration, omitting all flags such as indication of breakage)</p></li>
<li><p>frag (transliteration; including flags)</p></li>
<li><p>gdl_utf8 (cuneiform)</p></li>
<li><p>gw (Guide Word: main or first translation in standard dictionary)</p></li>
<li><p>id_text (six-digit P, Q, or X number)</p></li>
<li><p>id_word (word ID in the format Text_ID.Line_ID.Word_ID)</p></li>
<li><p>label (traditional line number in the form o ii 2’ (obverse column 2 line 2’), etc.)</p></li>
<li><p>lang (language code, including sux, sux-x-emegir, sux-x-emesal, akk, akk-x-stdbab, etc)</p></li>
<li><p>morph (Morphology; Sumerian only)</p></li>
<li><p>norm (Normalization: Akkadian)</p></li>
<li><p>norm0 (Normalization: Sumerian)</p></li>
<li><p>pos (Part of Speech)</p></li>
<li><p>sense (contextual meaning)</p></li>
<li><p>sig (full ORACC signature)</p></li>
<li><p>(newly added) ftype (<code class="docutils literal notranslate"><span class="pre">yn</span></code> if a node represents a year name)</p></li>
</ul>
<p>Not all data elements (columns) are available for all words. Sumerian words never have a <code class="docutils literal notranslate"><span class="pre">norm</span></code>, Akkadian words do not have <code class="docutils literal notranslate"><span class="pre">norm0</span></code>, <code class="docutils literal notranslate"><span class="pre">base</span></code>, <code class="docutils literal notranslate"><span class="pre">cont</span></code>, or <code class="docutils literal notranslate"><span class="pre">morph</span></code>. Most data elements are only present when the word is lemmatized; only <code class="docutils literal notranslate"><span class="pre">lang</span></code>, <code class="docutils literal notranslate"><span class="pre">form</span></code>, <code class="docutils literal notranslate"><span class="pre">id_word</span></code>, and <code class="docutils literal notranslate"><span class="pre">id_text</span></code> should always be there.</p>
<p>We also included some metadata:</p>
<ul class="simple">
<li><p>date</p></li>
<li><p>dates_references</p></li>
<li><p>primary_publication</p></li>
<li><p>collection</p></li>
<li><p>museum_no</p></li>
</ul>
<p>The first two of which refer to the dates on the tablets and the last three of which refer to the current ownership and where the tablet was published.</p>
</div>
<div class="section" id="create-line-id">
<h3>4.3 Create Line ID<a class="headerlink" href="#create-line-id" title="Permalink to this headline">¶</a></h3>
<p>The DataFrame currently has a word-by-word data representation. We will add to each word a field <code class="docutils literal notranslate"><span class="pre">id_line</span></code> that will make it possible to reconstruct lines. This newly created field <code class="docutils literal notranslate"><span class="pre">id_line</span></code> is different from a traditional line number (found in the field “label”) in two ways. First, id_line is an integer, so that lines are sorted correctly. Second, <code class="docutils literal notranslate"><span class="pre">id_line</span></code> is assigned to words, but also to gaps and horizontal drawings on the tablet. The field <code class="docutils literal notranslate"><span class="pre">id_line</span></code> will allow us to keep all these elements in their proper order.</p>
<p>The field “id_line” is created by splitting the field “id_word” into (two or) three elements. The format of “id_word” is IDtext.line.word. The middle part, id_line, is selected and its data type is changed from string to integer. Rows that represent gaps in the text or horizontal drawings have an “id_word” in the format IDtext.line (consisting of only two elements), but are treated in exactly the same way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_df</span><span class="p">[</span><span class="s1">&#39;id_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">wordid</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">wordid</span> <span class="ow">in</span> <span class="n">words_df</span><span class="p">[</span><span class="s1">&#39;id_word&#39;</span><span class="p">]]</span>
<span class="n">words_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-lemma-column">
<h2>5 Create Lemma Column<a class="headerlink" href="#create-lemma-column" title="Permalink to this headline">¶</a></h2>
<p>A lemma, <a class="reference external" href="http://oracc.org">ORACC</a> style, combines Citation Form, GuideWord and POS into a unique reference to one particular lemma in a standard dictionary, as in <code class="docutils literal notranslate"><span class="pre">lugal[king]N</span></code> (Sumerian) or <code class="docutils literal notranslate"><span class="pre">šarru[king]N</span></code>.</p>
<p>Proper Nouns (proper names, geographical names, etc.) are a special case, because they currently receive a Part of Speech, but not a Citation Form or Guide Word.</p>
<p>Usually, not all words in a text are lemmatized, because a word may be (partly) broken and/or unknown. Unlemmatized and unlemmatizable words will receive a place-holder lemmatization that consists of the transliteration of the word (instead of the Citation Form), with <code class="docutils literal notranslate"><span class="pre">NA</span></code> as GuideWord and <code class="docutils literal notranslate"><span class="pre">NA</span></code> as POS, as in <code class="docutils literal notranslate"><span class="pre">i-bu-x[NA]NA</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">NA</span></code> is a string.</p>
<p>Finally, rows representing horizontal rulings, blank lines, or broken lines have data in the fields ‘state’, ‘scope’, and ‘extent’ (for instance ‘state’ = broken, ‘scope’ = line, and ‘extent’ = 3, to indicate three broken lines). We can use this to prevent scripts to ‘jump over’ such breaks when looking for key words after (or before) a proper noun. We distinguish between physical breaks and logical breaks (such as horizontal rulings or seal impressions).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">proper_nouns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FN&#39;</span><span class="p">,</span> <span class="s1">&#39;PN&#39;</span><span class="p">,</span> <span class="s1">&#39;DN&#39;</span><span class="p">,</span> <span class="s1">&#39;AN&#39;</span><span class="p">,</span> <span class="s1">&#39;WN&#39;</span><span class="p">,</span> <span class="s1">&#39;ON&#39;</span><span class="p">,</span> <span class="s1">&#39;TN&#39;</span><span class="p">,</span> <span class="s1">&#39;MN&#39;</span><span class="p">,</span> <span class="s1">&#39;CN&#39;</span><span class="p">,</span> <span class="s1">&#39;GN&#39;</span><span class="p">]</span>
<span class="n">physical_break</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;illegible&#39;</span><span class="p">,</span> <span class="s1">&#39;traces&#39;</span><span class="p">,</span> <span class="s1">&#39;missing&#39;</span><span class="p">,</span> <span class="s1">&#39;effaced&#39;</span><span class="p">]</span>
<span class="n">logical_break</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="s1">&#39;blank&#39;</span><span class="p">,</span> <span class="s1">&#39;ruling&#39;</span><span class="p">]</span>
<span class="n">words_df</span><span class="p">[</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words_df</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">words_df</span><span class="p">[</span><span class="s2">&quot;gw&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span> <span class="o">+</span> <span class="n">words_df</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span>
<span class="n">words_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words_df</span><span class="p">[</span><span class="s2">&quot;cf&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words_df</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;[NA]NA&#39;</span>
<span class="n">words_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words_df</span><span class="p">[</span><span class="s2">&quot;pos&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span> <span class="p">,</span> <span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">words_df</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;[]NU&#39;</span> 
<span class="c1">#words_df.loc[words_df[&quot;pos&quot;].isin(proper_nouns) , &#39;lemma&#39;] = words_df[&#39;form&#39;] + &#39;[]&#39; + words_df[&#39;pos&#39;]</span>
<span class="n">words_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words_df</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">logical_break</span><span class="p">),</span> <span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;break_logical&quot;</span>
<span class="n">words_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">words_df</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">physical_break</span><span class="p">),</span> <span class="s1">&#39;lemma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;break_physical&quot;</span>
<span class="n">words_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="select-relevant-columns">
<h2>6 Select Relevant Columns<a class="headerlink" href="#select-relevant-columns" title="Permalink to this headline">¶</a></h2>
<p>Now we can select only the field ‘lemma’ and the fields that indicate the ID of the word, the line, or the document, plus the metadata, and the field ‘label’, which indicates the physical position of the line on the document.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lemma&#39;</span><span class="p">,</span> <span class="s1">&#39;id_text&#39;</span><span class="p">,</span> <span class="s1">&#39;id_line&#39;</span><span class="p">,</span> <span class="s1">&#39;id_word&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;dates_references&#39;</span><span class="p">,</span> <span class="s1">&#39;publication&#39;</span><span class="p">,</span> <span class="s1">&#39;collection&#39;</span><span class="p">,</span> <span class="s1">&#39;museum_no&#39;</span><span class="p">,</span> <span class="s1">&#39;ftype&#39;</span><span class="p">,</span> <span class="s1">&#39;metadata_source&#39;</span><span class="p">]</span>
<span class="n">words_df</span> <span class="o">=</span> <span class="n">words_df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">words_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can simplify the ‘id_text’ column, because all documents derive from the same project (epsd2/admnin/u3adm).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_df</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tid</span><span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">:]</span> <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">words_df</span><span class="p">[</span><span class="s1">&#39;id_text&#39;</span><span class="p">]]</span>
<span class="n">words_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">words_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">4000</span><span class="p">)</span>
<span class="n">test</span><span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;lemma&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="save-results-in-csv-file-pickle">
<h2>7 Save Results in CSV file &amp; Pickle<a class="headerlink" href="#save-results-in-csv-file-pickle" title="Permalink to this headline">¶</a></h2>
<p>The output file is called <code class="docutils literal notranslate"><span class="pre">part_1_output.csv</span></code> and is placed in the directory <code class="docutils literal notranslate"><span class="pre">output</span></code>. In most computers, <code class="docutils literal notranslate"><span class="pre">csv</span></code> files open automatically in Excel. This program does not deal well with <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> encoding (files in <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> need to be imported; see the instructions <a class="reference external" href="https://www.itg.ias.edu/content/how-import-csv-file-uses-utf-8-character-encoding-0">here</a>. If you intend to use the file in Excel, change <code class="docutils literal notranslate"><span class="pre">encoding</span> <span class="pre">='utf-8'</span></code> to <code class="docutils literal notranslate"><span class="pre">encoding='utf-16'</span></code>. For usage in computational text analysis applications <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> is usually preferred.</p>
<p>The Pandas function <code class="docutils literal notranslate"><span class="pre">to_pickle()</span></code> writes a binary file that can be opened in a later phase of the project with the <code class="docutils literal notranslate"><span class="pre">read_pickle()</span></code> command and will reproduce exactly the same DataFrame with the same data structure. The resulting file can only be used by pandas.</p>
<p>You can skip Part I by importing the Part I output as a pandas dataframe at the beginning of Part II. Similarly, in the next parts, after you save the output, you will be able to import that output later on instead of rerunning the sections before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;output/part_1_output.csv&#39;</span><span class="p">)</span>
<span class="n">words_df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;output/part_1_output.p&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="welcome.html" title="previous page">Sumerian Networks JupyterBook</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>